<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Email Campaign Manager</title>
  <link rel="stylesheet" href="/css/auth.css">
  <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
  <div class="background-gradient"></div>

  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <a href="/dashboard.html">ðŸ“§ Email Campaign Manager</a>
      </div>

      <div class="nav-menu" id="navMenu">
        <a href="#dashboard" class="nav-link active" data-section="dashboard">Dashboard</a>
        <a href="#smtp-config" class="nav-link" data-section="smtp-config">SMTP Config</a>
        <a href="#new-campaign" class="nav-link" data-section="new-campaign">New Campaign</a>
        <a href="#campaigns" class="nav-link" data-section="campaigns">History</a>
      </div>

      <div class="nav-user">
        <div class="user-dropdown" id="userDropdown">
          <button class="user-button" id="userButton">
            <span class="user-email" id="userEmail">Loading...</span>
            <svg class="dropdown-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          </button>

          <div class="dropdown-menu" id="dropdownMenu" style="display: none;">
            <button class="dropdown-item" id="logoutButton">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3 3a1 1 0 011 1v12a1 1 0 102 0V4a1 1 0 011-1h10a1 1 0 011 1v12a1 1 0 102 0V4a1 1 0 011-1h2a1 1 0 110 2h-2v12a3 3 0 01-3 3H5a3 3 0 01-3-3V4a1 1 0 011-1z" clip-rule="evenodd"/>
              </svg>
              Logout
            </button>
          </div>
        </div>
      </div>

      <button class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="dashboard-container">
    <!-- Dashboard Section -->
    <section id="dashboard-section" class="content-section active">
      <div class="dashboard-header">
        <h1>Dashboard</h1>
        <p class="dashboard-subtitle">Manage your email campaigns</p>
      </div>

      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon smtp-icon">
            <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-label">SMTP Status</div>
            <div class="stat-value" id="smtpStatus">Checking...</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon campaigns-icon">
            <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
              <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
              <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-label">Total Campaigns</div>
            <div class="stat-value" id="totalCampaigns">0</div>
          </div>
        </div>

        <div class="stat-card success">
          <div class="stat-icon sent-icon">
            <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
              <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
              <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-label">Emails Sent</div>
            <div class="stat-value" id="emailsSent">0</div>
          </div>
        </div>

        <div class="stat-card error">
          <div class="stat-icon failed-icon">
            <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="stat-content">
            <div class="stat-label">Failed</div>
            <div class="stat-value" id="emailsFailed">0</div>
          </div>
        </div>
      </div>

      <!-- Recent Campaigns -->
      <div class="section-card">
        <h2 class="section-title">Recent Campaigns</h2>
        <div id="recentCampaigns" class="campaigns-list">
          <p class="empty-state">No campaigns yet. Create your first campaign!</p>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <a href="#smtp-config" class="action-button primary" data-section="smtp-config">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
          </svg>
          Configure SMTP
        </a>
        <a href="#new-campaign" class="action-button secondary" data-section="new-campaign">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
          </svg>
          New Campaign
        </a>
      </div>
    </section>

    <!-- SMTP Config Section -->
    <section id="smtp-config-section" class="content-section">
      <div class="section-card">
        <h2 class="section-title">SMTP Configuration</h2>
        <p class="section-subtitle">Configure your Gmail SMTP settings to send emails</p>

        <!-- Gmail Instructions (Collapsible) -->
        <div class="instructions-card">
          <button class="instructions-toggle" id="instructionsToggle" type="button">
            <svg class="toggle-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
            </svg>
            How to get Gmail App Password
            <svg class="chevron-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          </button>

          <div class="instructions-content" id="instructionsContent" style="display: none;">
            <ol class="instructions-list">
              <li>Go to your <a href="https://myaccount.google.com/security" target="_blank" rel="noopener noreferrer">Google Account Security</a></li>
              <li>Enable <strong>2-Step Verification</strong> if not already enabled</li>
              <li>Search for <strong>"App passwords"</strong> in the search bar</li>
              <li>Click <strong>"App passwords"</strong></li>
              <li>Select <strong>"Mail"</strong> as the app</li>
              <li>Select <strong>"Other"</strong> as the device and enter "Email Campaign Manager"</li>
              <li>Click <strong>"Generate"</strong></li>
              <li>Copy the 16-character password and paste it below</li>
            </ol>
            <div class="instructions-note">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <p><strong>Note:</strong> App passwords are required if you have 2-Step Verification enabled. This is more secure than using your actual Gmail password.</p>
            </div>
          </div>
        </div>

        <!-- SMTP Configuration Form -->
        <form id="smtpConfigForm" class="smtp-form">
          <div class="form-group">
            <label for="gmailEmail" class="form-label">Gmail Email Address</label>
            <input type="email" id="gmailEmail" name="gmailEmail" class="form-input" placeholder="your-email@gmail.com" required />
            <span class="form-error" id="gmailEmailError"></span>
          </div>

          <div class="form-group">
            <label for="appPassword" class="form-label">Gmail App Password</label>
            <input type="password" id="appPassword" name="appPassword" class="form-input" placeholder="16-character app password" />
            <span class="form-error" id="appPasswordError"></span>
          </div>

          <div class="form-group">
            <label for="fromName" class="form-label">From Name (Display Name)</label>
            <input type="text" id="fromName" name="fromName" class="form-input" placeholder="Your Name or Company" required />
            <span class="form-error" id="fromNameError"></span>
          </div>

          <div class="form-actions">
            <button type="button" id="testConnectionBtn" class="btn btn-secondary">
              <span class="btn-text">Test Connection</span>
              <span class="btn-spinner" style="display: none;">
                <svg class="spinner" width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </span>
            </button>

            <button type="submit" id="saveConfigBtn" class="btn btn-primary">
              <span class="btn-text">Save Configuration</span>
              <span class="btn-spinner" style="display: none;">
                <svg class="spinner" width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </span>
            </button>
          </div>
        </form>

        <!-- Status Messages -->
        <div id="smtpMessages" class="messages-container"></div>
      </div>
    </section>

    <!-- New Campaign Section -->
    <section id="new-campaign-section" class="content-section">
      <div class="section-card">
        <h2 class="section-title">Create New Campaign</h2>
        <p class="section-subtitle">Upload CSV and create your email template</p>

        <form id="campaignForm" onsubmit="event.preventDefault(); createAndSendCampaign();">
          <!-- CSV Upload -->
          <div class="form-group">
            <label class="form-label">Upload Recipients CSV</label>
            <div id="dropZone" class="drop-zone">
              <svg width="48" height="48" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
              <p>Drag & drop CSV file here or click to browse</p>
              <p class="drop-zone-hint">Max 5MB, must include 'email' column</p>
            </div>
            <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
          </div>

          <!-- CSV Preview -->
          <div id="csvPreview" class="csv-preview"></div>

          <!-- Variable Tags -->
          <div id="variableTags" class="variable-tags"></div>

          <!-- Campaign Details -->
          <div class="form-group">
            <label for="campaignName" class="form-label">Campaign Name</label>
            <input type="text" id="campaignName" class="form-input" placeholder="e.g., Product Launch 2024" required>
          </div>

          <div class="form-group">
            <label for="emailSubject" class="form-label">Email Subject</label>
            <input type="text" id="emailSubject" class="form-input" placeholder="Use {{variables}} from CSV" required>
          </div>

          <div class="form-group">
            <label for="emailBody" class="form-label">Email Body</label>
            <textarea id="emailBody" class="form-textarea" rows="10" placeholder="Use {{variables}} for personalization..." required></textarea>
          </div>

          <div class="form-actions">
            <button type="button" id="previewEmailsBtn" class="btn btn-secondary">Preview Emails</button>
            <button type="submit" id="sendCampaignBtn" class="btn btn-primary">Create & Send Campaign</button>
          </div>
        </form>
      </div>
    </section>

    <!-- Campaigns History Section -->
    <section id="campaigns-section" class="content-section">
      <div class="section-card">
        <h2 class="section-title">Campaign History</h2>
        <p class="section-subtitle">View all your email campaigns</p>

        <div id="campaignsList" class="campaigns-table-wrapper">
          <p class="empty-state">Loading campaigns...</p>
        </div>
      </div>
    </section>
  </main>

  <script src="/js/token-manager.js"></script>
  <script src="/js/api.js"></script>
  <script src="/js/dashboard.js"></script>
  <script src="/js/smtpConfig.js"></script>
  <script src="/js/emailPreview.js"></script>
  <script src="/js/sendingProgress.js"></script>
  <script src="/js/campaignBuilder.js"></script>
  <script src="/js/campaignHistory.js"></script>
</body>
</html>
